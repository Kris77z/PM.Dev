## PRD-to-HTML 原型生成功能设计方案

本文档旨在详细阐述一项新功能的设计思路：基于现有的产品需求文档（PRD）生成器，利用 AI 能力自动创建一个可交互的、简单的 HTML 页面原型。此方案深受 `dyad` 项目的启发，旨在将结构化的产品需求快速转化为可视化原型，以加速验证和迭代过程。

### 1. 核心思路

我们的目标是构建一个自动化工作流，其输入为 "PRD 工具" 中生成的结构化需求数据，输出为一个独立的、可预览的 HTML 文件。这个工作流的核心是设计一个专门的 AI Agent，它能理解 PRD 的内容，并根据预设的指令生成符合要求的网页代码。

### 2. 方案设计：四步工作流

我们将整个流程分解为四个主要步骤：

**步骤一：结构化 PRD 数据提取**

- **输入源**: 我们不直接使用 `prd-generator.ts` 生成的最终 Markdown 文本，而是利用其上游的、结构化的 `data` 对象。该对象包含了如 `userScenarios`, `requirementSolution` 等已清晰组织的 JSON 数据，这是 AI 进行精确转换的理想格式。
- **实现**: 在 "PRD 工具" 的现有逻辑中，增加一个节点，在用户填写完 PRD 信息后，将这份 `data` 对象捕获并传递给下一步。

**步骤二：构建专用的"原型生成 AI Agent"**

- **核心任务**: 这是整个方案的智慧所在。我们需要精心设计一个 System Prompt，来"训练"一个临时的 AI Agent，使其具备将 PRD 数据转换为 HTML 页面的能力。
- **Prompt 设计要点**:
    - **角色定义**: "你是一位资深前端工程师，你的任务是将接收到的 JSON 格式的 PRD 数据转换成一个结构清晰、带交互效果的单体 HTML 页面。"
    - **输出指令**:
        - **格式**: 要求必须生成一个包含 HTML, CSS, และ JavaScript 的完整 `index.html` 文件。
        - **样式**: 指示使用 [Tailwind CSS via CDN](https://tailwindcss.com/docs/installation/play-cdn) 来进行样式设计，以避免复杂的编译环境。
        - **结构**: 指导 AI 如何映射 PRD 数据到 HTML 元素。例如：`requirementSolution.name` 成为页面主标题 (`<h1>`)，`userScenarios` 渲染为无序列表 (`<ul><li>`)。
        - **交互**: 明确要求加入简单的 JavaScript 交互，例如："为每个主要模块（如'用户场景'）的标题添加点击事件，实现内容的展开和折叠效果。"
    - **模板参考**: 引导 AI 使用 `dyad/scaffold/index.html` 的基本结构作为 HTML 文件的骨架。

**步骤三：AI 调用与代码生成**

- **执行**: 将上一步构建的完整 Prompt（包含角色定义、指令和结构化的 PRD 数据）发送给大语言模型（如 Gemini）。
- **接收**: AI 模型将直接返回一个包含完整 HTML 代码的字符串。我们可以要求它用 markdown 的 ` ```html ` 代码块包裹返回内容，便于前端提取。

**步骤四：文件生成与实时预览**

- **文件写入 (借鉴 `<dyad-write>`)**: 在前端应用中，接收到 AI 返回的 HTML 字符串后，通过 JavaScript 将其内容创建一个 `Blob` 对象，并生成一个临时的 URL。或者，如果环境允许（如在 Electron 或类似环境中），可以将其直接写入本地磁盘的特定目录（如 `public/generated-prds/`）。
- **实时预览 (借鉴 `iframe`)**: 在 "PRD 工具" 页面中，新增一个"生成原型"按钮。点击后，执行上述流程，并将最终生成的 HTML 内容或文件 URL 设置为一个 `iframe` 的 `src` 属性。这样，用户就能在不离开当前页面的情况下，立即看到并与 PRD 的可视化原型进行交互。

### 3. 对 `dyad` 项目参考点的具体应用

您提到的几个 `dyad` 的优点，将按以下方式融入我们的设计中：

1.  **AI 驱动开发**: 我们完全采纳其核心理念，创建一个专门服务于 PRD 可视化的 AI Agent。
2.  **技术栈**: 我们将使用轻量级的 HTML、JavaScript 和通过 CDN 引入的 Tailwind CSS，这与 `dyad` 使用现代前端栈的理念一致，同时更适合快速生成简单的静态页面。
3.  **`<dyad-write>` 机制**: 我们将实现其"将 AI 生成的代码写入文件"的最终效果，但简化中间过程，无需自定义 XML 标签。
4.  **`iframe` 预览**: 这是我们方案中不可或缺的一环，是实现快速反馈和验证的关键。
5.  **组件/页面结构**: 对于生成单个 HTML 文件的需求，我们暂时不需要复杂的目录结构。但 `dyad` 的组织方式提醒我们，未来如果功能扩展（例如生成多页面原型），可以借鉴其 `src/pages` 和 `src/components` 的划分方式。
6.  **测试用例与 `scaffold`**: `scaffold/index.html` 为我们的 AI Agent 提供了绝佳的初始模板。而 `chat_stream_handlers.test.ts` 中的示例则证明了，只要给予 AI 足够清晰和结构化的指令，它完全有能力生成完整的、多文件的应用——这增强了我们生成单个高质量 HTML 文件的信心。

### 4. 实现进度

#### 已完成功能
✅ **步骤一：结构化PRD数据提取**
- PRD数据类型定义和导出
- 与现有PRD生成器的数据结构集成

✅ **步骤二：构建专用的"原型生成AI Agent"**
- 创建详细的AI提示模板 (`src/prompts/prd-to-html-prompt.ts`)
- 实现PRD数据到提示的转换逻辑
- 支持用户自定义要求的集成

✅ **步骤三：AI调用与代码生成**
- 创建专用的HTML生成API路由 (`src/app/api/ai-html-generator/route.ts`)
- 集成Gemini AI服务调用
- 实现带重试机制的稳定API调用
- HTML内容提取和验证逻辑

✅ **步骤四：文件生成与实时预览**
- 创建HTML原型预览组件 (`src/components/prd-house/HTMLPrototypePreview.tsx`)
- 实现多设备预览模式（桌面/平板/手机）
- 支持HTML代码查看、历史记录管理
- 集成到PRD工具的完成视图中

#### 核心特性
- **智能生成**：基于结构化PRD数据自动生成可交互的HTML原型
- **自定义优化**：支持用户输入额外要求来优化生成效果
- **多设备预览**：支持桌面、平板、手机三种视图模式
- **代码查看**：可以查看和下载生成的HTML源代码
- **历史管理**：保存最近5次生成记录，支持恢复历史版本
- **错误处理**：完善的错误处理和用户反馈机制

#### 技术架构
- **前端组件**：使用React + TypeScript + Tailwind CSS
- **状态管理**：自定义Hook管理生成状态和历史记录
- **AI服务**：集成Gemini 2.0 Flash模型进行HTML生成
- **文件处理**：使用Blob API实现文件预览和下载
- **界面设计**：模态弹窗设计，不干扰主要的PRD工作流

### 5. 使用方法

1. **完成PRD创建**：在PRD工具中填写完整的产品需求信息
2. **生成PRD文档**：完成AI审查并生成PRD文档
3. **点击"生成HTML原型"**：在完成页面点击蓝色的原型生成按钮
4. **自定义要求**（可选）：在左侧输入框中添加特殊要求，如"添加深色主题"、"优化移动端体验"等
5. **开始生成**：点击生成按钮，AI将在30-60秒内生成完整的HTML原型
6. **预览和调整**：使用多设备预览模式查看效果，可以查看源代码或下载文件
7. **历史管理**：可以重新生成或恢复之前的版本

### 6. 总结

该功能成功将 "PRD 工具" 升级为具备原型生成能力的完整产品设计工具链。通过AI的智能理解和代码生成能力，用户可以在几分钟内从产品需求文档直接获得可交互的HTML原型，极大地提高了产品设计和验证的效率。

这个实现充分体现了AI在产品开发中的价值，为后续的功能扩展（如生成多页面应用、集成更多交互组件等）奠定了坚实的技术基础。 