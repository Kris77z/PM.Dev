# PM-Assistant 与 BBX 集成方案：基于截图的可视化页面及区域选择

## 1. 背景与目标

在UI微调场景中，产品经理（PM）需要准确地向 pm-assistant 描述需要修改的UI元素。传统的纯文本描述方式存在以下问题：
- 描述不够精确，容易产生歧义
- PM需要花费大量时间思考如何描述UI元素
- IDE中的AI可能对文字描述理解有偏差

本方案旨在通过在 pm-assistant 中展示 BBX 页面截图，实现直观的页面和区域选择，从而提升UI微调指令中目标定位的准确性。

## 2. 核心设计思路

### 2.1 基于截图的页面预览
- 在 pm-assistant 的表单界面中展示 BBX 页面的静态截图。
- 截图作为可视化参照，帮助PM确认目标页面。

### 2.2 分步式页面及区域选择
- PM首先通过下拉框选择目标页面（参照截图）。
- 然后，基于预设的页面区域数据，PM进一步选择页面中的具体版块或区域。
- 页面和区域信息均来自预先整理的 `bbx-project-analysis.json` 文件。

### 2.3 基于高亮层或骨架图的可视化辅助 (未来)
- **不** 通过 iframe 嵌入实际页面并抓取实时 DOM 信息。
- **不** 依赖复杂的 DOM 路径或样式信息进行元素定位。
- 未来的元素或更精细区域选择的可视化，将在截图上通过 **独立的、覆盖在截图上的高亮层或骨架图** 来实现。
- 这层高亮将通过前端技术（如 CSS 叠加、Canvas 绘制）实现，其位置和尺寸信息需要与 `bbx-project-analysis.json` 中的区域数据进行关联或在前端计算。

### 2.4 信息传递与处理
- PM 完成页面和区域选择后，相关的 value/label 信息将被捕获。
- 这些信息将用于生成结构化、精确的UI调整指令，其中包含选定的页面和区域的标识符。
- AI 将根据这些标识符和预设的组件路径映射（`bbx-project-analysis.json` 中的 `componentPathHints`）来定位代码文件。

## 3. 技术实现细节 (当前已实现步骤)

### 3.1 页面选择与截图展示
- 在新的 `page-selector-demo` 页面中实现。
- 使用 `Select` 组件展示 `bbx-project-analysis.json` 中定义的页面选项。
- 根据选择的页面 value，从预设的 `PAGE_SCREENSHOTS` 映射中加载并展示对应的截图。
- 实现截图的放大预览功能。

### 3.2 区域选择
- 在页面选择之后，进入第二步区域选择。
- 使用 `Select` 组件展示 `bbx-project-analysis.json` 中对应页面的区域选项。
- 根据页面选择的结果动态更新区域选项。

```typescript
// 示例代码 (page-selector-demo/page.tsx)
// 已完成页面和区域选择的UI和逻辑实现
// ... (相关 Select, Image, Stepper 组件的使用)
// answers 状态管理页面和区域的选择结果
// useEffect 钩子根据选中的页面更新区域选项
// renderStepContent 函数渲染不同步骤的UI
```

## 4. 优势与特点 (基于 refined 方案)

### 4.1 简化实现与降低风险
- 避免了 iframe 跨域通信的复杂性和安全风险。
- 不依赖目标页面的实时 DOM 结构，不受页面前端技术栈或动态加载内容的影响。
- 避免了复杂的 DOM 路径抓取和解析。

### 4.2 聚焦核心问题
- 将页面/区域的选择与底层的代码定位解耦。
- 高亮功能仅作为可视化辅助，不承担精确元素定位的职责（精确元素定位通过 AI 分析和路径提示完成）。

### 4.3 易于维护和扩展
- 区域信息的更新主要集中在 `bbx-project-analysis.json` 文件。
- 可视化高亮层与页面预览逻辑分离，便于独立开发和迭代。

## 5. 后续规划

### 5.1 可视化高亮实现
- 研究如何在页面截图上绘制高亮层或使用骨架图。
- 探索如何将 `bbx-project-analysis.json` 中的区域信息与截图上的位置进行关联，以便精确绘制高亮。
- 实现用户点击高亮区域时捕获区域信息的功能（尽管这不是用于精确 DOM 定位，但可用于确认选择）。

### 5.2 与后续步骤集成
- 将页面和区域选择的结果传递给后续步骤（例如，元素描述、效果期望等）。
- 结合 `bbx-project-analysis.json` 中的 `componentPathHints` 数据，为 AI 提供更精确的代码定位提示。

### 5.3 用户体验优化
- 优化截图加载和展示效果。
- 改进步骤导航和状态提示。
- 考虑如何更友好的处理没有预设区域的页面。

## 6. 总结

通过基于截图的页面及区域选择方案，我们构建了一个简化且稳健的UI微调目标定位基础。未来的可视化高亮将作为辅助手段，核心的定位逻辑将依赖于结构化的项目分析数据和 AI 的代码理解能力。这个方案有效地平衡了用户体验和技术实现的复杂性，为后续的UI微调流程奠定了坚实基础。 